<?xml version="1.0" encoding="utf-8"?>
<Report xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition" xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner">
  <DataSources>
    <DataSource Name="SQL1_DENVERAPP">
      <rd:DataSourceID>6265a134-6dcb-404f-9e78-bbbe11c3bd48</rd:DataSourceID>
      <DataSourceReference>SQL1_DENVERAPP</DataSourceReference>
    </DataSource>
  </DataSources>
  <rd:ReportID>1ca08bfd-120b-43a8-a0ff-a24e7f4241dd</rd:ReportID>
  <Width>5in</Width>
  <Body>
    <Height>0.63in</Height>
    <ColumnSpacing>0.5in</ColumnSpacing>
    <ReportItems>
      <Textbox Name="textbox1">
        <rd:DefaultName>textbox1</rd:DefaultName>
        <Value>test headers</Value>
        <Style>
          <PaddingLeft>2pt</PaddingLeft>
          <PaddingRight>2pt</PaddingRight>
          <PaddingTop>2pt</PaddingTop>
          <PaddingBottom>2pt</PaddingBottom>
        </Style>
        <CanGrow>true</CanGrow>
        <Height>0.21in</Height>
      </Textbox>
      <Table Name="table1">
        <Top>0.21in</Top>
        <Header>
          <RepeatOnNewPage>true</RepeatOnNewPage>
          <TableRows>
            <TableRow>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox2">
                      <rd:DefaultName>textbox2</rd:DefaultName>
                      <Value>Project</Value>
                      <Style>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <CanGrow>true</CanGrow>
                      <Height>0.21in</Height>
                      <Width>1in</Width>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
              <Height>0.21in</Height>
            </TableRow>
          </TableRows>
        </Header>
        <Details>
          <TableRows>
            <TableRow>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="Project">
                      <rd:DefaultName>Project</rd:DefaultName>
                      <Value>=Fields!Project.Value</Value>
                      <Style>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <CanGrow>true</CanGrow>
                      <Height>0.21in</Height>
                      <Width>1in</Width>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
              <Height>0.21in</Height>
            </TableRow>
          </TableRows>
        </Details>
        <TableColumns>
          <TableColumn>
            <Width>1in</Width>
          </TableColumn>
        </TableColumns>
        <DataSetName>DataSet1</DataSetName>
      </Table>
    </ReportItems>
  </Body>
  <Language>en-US</Language>
  <LeftMargin>1in</LeftMargin>
  <RightMargin>1in</RightMargin>
  <TopMargin>1in</TopMargin>
  <BottomMargin>1in</BottomMargin>
  <PageWidth>8.5in</PageWidth>
  <PageHeight>11in</PageHeight>
  <DataSets>
    <DataSet Name="DataSet1">
      <Fields>
        <Field Name="Project">
          <DataField>Project</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="project_billwith">
          <DataField>project_billwith</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="ClientID">
          <DataField>ClientID</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="ClientName">
          <DataField>ClientName</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="ProductID">
          <DataField>ProductID</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="PM">
          <DataField>PM</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="AcctService">
          <DataField>AcctService</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="Project_Desc">
          <DataField>Project_Desc</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="ClientContact">
          <DataField>ClientContact</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="ContactEmailAddress">
          <DataField>ContactEmailAddress</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="ClientRefNo">
          <DataField>ClientRefNo</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="ECD">
          <DataField>ECD</DataField>
          <rd:TypeName>System.DateTime</rd:TypeName>
        </Field>
        <Field Name="OnShelfDate">
          <DataField>OnShelfDate</DataField>
          <rd:TypeName>System.DateTime</rd:TypeName>
        </Field>
        <Field Name="Final_On_Shelf_Date">
          <DataField>Final On-Shelf Date</DataField>
          <rd:TypeName>System.DateTime</rd:TypeName>
        </Field>
        <Field Name="CloseDate">
          <DataField>CloseDate</DataField>
          <rd:TypeName>System.DateTime</rd:TypeName>
        </Field>
        <Field Name="OfferNum">
          <DataField>OfferNum</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="ULEAmount">
          <DataField>ULEAmount</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="CLEAmount">
          <DataField>CLEAmount</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="CLEFeeAmount">
          <DataField>CLEFeeAmount</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="TRVActuals">
          <DataField>TRVActuals</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="OOPActuals">
          <DataField>OOPActuals</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="OpenPO">
          <DataField>OpenPO</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="Actuals">
          <DataField>Actuals</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="BTD">
          <DataField>BTD</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="WIPOver60Amount">
          <DataField>WIPOver60Amount</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="ProjectHours">
          <DataField>ProjectHours</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="FltClientID">
          <DataField>FltClientID</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="FltProductCode">
          <DataField>FltProductCode</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="FltProject">
          <DataField>FltProject</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="FltProjectDesc">
          <DataField>FltProjectDesc</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="FltProjectStatus">
          <DataField>FltProjectStatus</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="FltClientPO">
          <DataField>FltClientPO</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="FltPM">
          <DataField>FltPM</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="FltAcctSvc">
          <DataField>FltAcctSvc</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="FltOfferNum">
          <DataField>FltOfferNum</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="FltContractType">
          <DataField>FltContractType</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
      </Fields>
      <Query>
        <DataSourceName>SQL1_DENVERAPP</DataSourceName>
        <CommandType>Text</CommandType>
        <CommandText>-- Account Leadership FJR Report

-- For internal reporting use
DECLARE @CurrentDate Date	--Would have been used in used in WIP AGING logic
DECLARE @iYear as int
--DECLARE @iMonth as char(2)
--DECLARE @EndPerNbr as char(6)
SET @CurrentDate = getdate()
SET @iYear = YEAR(@CurrentDate)

--Main Querry
select p.Project as Project
, b.project_billwith  as project_billwith 
, p.pm_id01 as ClientID
, ISNULL(c.[name],'Customer Name Unavailable')   as ClientName
, p.pm_id02  as ProductID
, p.manager1  as PM
, p.manager2  as AcctService
, p.Project_Desc  as Project_Desc
, xc.CName  as ClientContact
, xc.EmailAddress  as ContactEmailAddress
, p.purchase_order_num  as ClientRefNo
, x.pm_id28 as ECD
, p.end_date as OnShelfDate
, CASE WHEN x.pm_id28 = '' THEN p.end_date ELSE x.pm_id28 END as 'Final On-Shelf Date'
, p.pm_id08 as CloseDate
, p.pm_id32 as OfferNum
, ISNULL(ULE.ULEAmount, 0) as ULEAmount
, ISNULL(CLE.CLEAmount, 0) as CLEAmount
, ISNULL(CLE.CLEFee, 0) as CLEFeeAmount
, ISNULL(TRV.TRAVActuals, 0) as TRVActuals
, ISNULL(OOP.OOPActuals, 0) as OOPActuals
, ISNULL(FJR.OpenPO, 0 ) as OpenPO
, ISNULL(FJR.Actuals, 0 ) as Actuals
, ISNULL(FJR.BTD, 0 ) as BTD
, ISNULL(RptWIP.WIPOvr60Amount, 0 ) AS WIPOver60Amount --Period Sensitive being removed
, ISNULL(ProjectHrs.TTLHrs, 0 ) as ProjectHours
-- Filtering fields required when adding logic for all parent child to return when either is pulled.
, ip.pm_id01 as FltClientID
, ip.pm_id02 as FltProductCode
, ip.project as FltProject
, ip.project_desc as FltProjectDesc
, ip.status_pa as FltProjectStatus
, ip.purchase_order_num as FltClientPO
, ip.manager1 as FltPM
, ip.manager2 as FltAcctSvc
, ip.pm_id32 as FltOfferNum
, ip.contract_type as FltContractType
From  --!!!!!! ALL FILTER CRITERIA MUST BE ON IP AND NOT P OR PARENT CHILD JOBS WILL NOT ALWAYS BE PULLED TOGETHER!!!!!!
PJPROJ ip  JOIN PJBILL A ON ip.Project = A.Project
           JOIN PJBILL B ON A.project_billwith = B.project_billwith 
  		 JOIN PJPROJ p ON b.project = p.project
		 LEFT OUTER JOIN CUSTOMER c ON p.pm_id01 = C.CustId
		 LEFT OUTER JOIN PJPROJEX x ON p.project = x.project
		 LEFT JOIN xClientContact xc ON p.user2 = xc.EA_ID
		 LEFT OUTER JOIN --FJR query.  To get down to one line for reporting pulling as main source
						( SELECT m.Project
						, ISNULL((Max(m.ExtCost) - Max(m.CostVouched)),0)  as OpenPO
						--Removing month logic as no period sensitivity.  Leaving code in as easy to uncomment.
						, SUM ( CASE WHEN m.AcctGroupCode IN ('WA','WP','CM','FE') THEN
								AmountBF + Amount01 + Amount02 + Amount03 + Amount04 + Amount05 + Amount06 + Amount07 + Amount08 + Amount09 + Amount10 + Amount11 + Amount12 + Amount13 + Amount14 + Amount15
								ELSE 0  END ) as Actuals
						--Removing month logic as no period sensitivity.  Leaving code in as easy to uncomment.
						, SUM ( CASE WHEN m.ControlCode = 'BTD' OR m.AcctGroupCode = 'PB' THEN
								AmountBF + Amount01 + Amount02 + Amount03 + Amount04 + Amount05 + Amount06 + Amount07 + Amount08 + Amount09 + Amount10 + Amount11 + Amount12 + Amount13 + Amount14 + Amount15
								ELSE 0  END ) as BTD
							From xvr_PA924_Main m 
							Where m.FSYearNum = @iYear 
							Group by m.Project ) FJR ON p.project = FJR.Project
							--END FJR query
		LEFT OUTER JOIN --Unlocked Estimate view by project
					xvr_Est_ULE_Project ULE ON p.Project = ULE.Project
		LEFT OUTER JOIN /*(Using Current Locked Estimate view with functions.  Must roll up to project or cartestion joins */
			( Select CLE.Project 
				, SUM ( CASE WHEN FC.code_group = 'FEE' THEN CLE.CLEAmount ELSE 0 END ) as CLEFee
				, SUM (CLE.CLEAmount) as CLEAmount 
			   From xvr_Est_CLE CLE JOIN xIGFunctionCode FC ON CLE.pjt_entity = FC.code_ID
			   Group by CLE.Project ) CLE ON p.Project = CLE.Project
        LEFT OUTER JOIN /*(Using Travel with functions.  Must roll up to project or cartestion joins */
			( -- Get the Travel Actuals
				SELECT project
				,  sum(Amount01 + Amount02 + Amount03 + Amount04 + Amount05 + Amount06 + Amount07 + Amount08 + Amount09 + Amount10 + Amount11 + Amount12 + Amount13 + Amount14 + Amount15)
				AS TRAVActuals
				FROM xvr_BU96C_Actuals where [Function] in (select code_ID from xIGFunctionCode where code_group = 'TRAV') and acct = 'Billable'
				group by project) TRV ON p.Project = TRV.Project
		LEFT OUTER JOIN /*(Using Out Of Pocket functions. This is all functions except TRAV and FEE Must roll up to project or cartestion joins */
			(-- Get the Out of Pocket Actuals
				SELECT project
				,  sum(Amount01 + Amount02 + Amount03 + Amount04 + Amount05 + Amount06 + Amount07 + Amount08 + Amount09 + Amount10 + Amount11 + Amount12 + Amount13 + Amount14 + Amount15)
				AS OOPActuals
				FROM xvr_BU96C_Actuals where [Function] in (select code_ID from xIGFunctionCode where code_group NOT IN ('TRAV','FEE')) and acct IN ('Billable','BILLABLE APS')
				group by project) OOP ON p.Project = OOP.Project
			   
		LEFT OUTER JOIN /*(Logic taken from BI902 and stripped down.  Including aging days for reuse*/	   
			--Per Email, include all WIP transactions.  Leaving in as easy to uncomment if decisions change.
				( SELECT d.project
							, SUM( CASE WHEN d.li_type NOT IN ('D', 'A') AND DateDiff(day, d.source_trx_date, GETDATE() /*@CurrentDate*/ ) &gt;60
								THEN d.amount
								ELSE 0
								END ) as WIPOvr60Amount
							
					FROM PJINVDET d LEFT JOIN PJINVHDR h ON d.draft_num = h.draft_num
							JOIN PJPROJ p ON d.project = p.project 
							JOIN PJACCT a ON d.acct = a.acct
					WHERE d.hold_status &lt;&gt; 'PG' 
						AND d.bill_status &lt;&gt; 'B'
						AND a.acct_group_cd NOT IN ('CM', 'FE')
						AND p.project NOT IN (SELECT JobID FROM xWIPAgingException)
						AND (substring(d.acct, 1, 6) &lt;&gt; 'OFFSET' OR d.acct = 'OFFSET PREBILL')
					Group By d.project	
						) RptWIP ON p.Project = RptWip.project
					/*  END WIP QUERY */
			LEFT OUTER JOIN --Time query taken from Client P&amp;L
						( SELECT PJTRAN.project
							,SUM(PJTRAN.units) AS TTLHrs --PJTRAN.units AS Hrs
						FROM PJTRAN PJTRAN 
						WHERE PJTRAN.acct = 'LABOR'
						Group By PJTRAN.Project										
						) ProjectHrs ON p.Project = ProjectHrs.Project
				--END Time Query
Where   A.project_billwith &lt;&gt; ''
AND ip.contract_type &lt;&gt; 'APS'
 --AND ip.project = @sProject
AND ip.pm_id01 = @sClientID
Order by p.Project</CommandText>
        <rd:UseGenericDesigner>true</rd:UseGenericDesigner>
        <QueryParameters>
          <QueryParameter Name="@sClientID">
            <Value>=Parameters!sClientID.Value</Value>
          </QueryParameter>
        </QueryParameters>
        <Timeout>0</Timeout>
      </Query>
    </DataSet>
  </DataSets>
  <ReportParameters>
    <ReportParameter Name="sClientID">
      <DataType>String</DataType>
      <Prompt>s Client ID</Prompt>
    </ReportParameter>
  </ReportParameters>
</Report>